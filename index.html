<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <textarea id="txtShow" disabled></textarea>
    <input id="txtInput" type="text" />

    <button id="btnSend">送出</button>
  </body>

  <script>
    document.addEventListener("DOMContentLoaded", (event) => {
      console.log(event);
      let keyinDom = document.querySelector("#txtInput");

      let showDom = document.querySelector("#txtShow");

      document.querySelector("#btnSend").addEventListener("click", () => {
        let txt = ["robby", keyinDom.value];
        ws.send(txt);
        console.log("in", txt);
      });

      // 建立 WebSocket (本例 server 端於本地運行)
      let url = location.origin.replace(/^http/, "ws");
      var ws = new WebSocket(url);
      // 監聽連線狀態
      ws.onopen = () => {
        console.log("open ");
      };
      ws.onclose = () => {
        console.log("close ");
      };
      //接收 Server 發送的訊息
      ws.onmessage = (event) => {
        let txt = event.data.split(",")[1];
        console.log(txt);
        if (!showDom.value) showDom.value = txt;
        else showDom.value = showDom.value + "\n" + txt;
        keyinDom.value = "";
      };
    });
  </script>
</html>
